<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Ppxlib__Location_check (ppxlib.Ppxlib__Location_check)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 1.5.1"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../index.html">ppxlib</a> &#x00BB; Ppxlib__Location_check</nav><h1>Module <code>Ppxlib__Location_check</code></h1><p>Enforces some invariants on AST nodes locations</p><nav class="toc"><ul><li><a href="#what?">What?</a></li><li><a href="#why?">Why?</a></li><li><a href="#guidelines-for-writing-well-behaved-ppxes">Guidelines for writing well-behaved ppxes</a></li></ul></nav></header><section><header><h3 id="what?"><a href="#what?" class="anchor"></a>What?</h3><p>The invariants are as follow:</p><ul><li>AST nodes are requested to be well nested wrt. locations</li><li>the locations of &quot;sibling&quot; AST nodes should not overlap</li></ul></header></section><section><header><h3 id="why?"><a href="#why?" class="anchor"></a>Why?</h3><p>This is required for merlin to behave properly.</p><p>Indeed, for almost any query directed at merlin, it will need to inspect the context around the user's cursor to give an answer that makes sense. And the only input it has to do that is the position of the cursor in the buffer. The handling of most queries starts by traversing the AST, using the locations of nodes to select the right branch. (1) is necessary to avoid discarding subtrees too early, (2) is used to avoid merlin making arbitrary choices (if you ask for the type under the cursor, and there seem to be two things under the cursor, merlin will need to pick one).</p></header></section><section><header><h3 id="guidelines-for-writing-well-behaved-ppxes"><a href="#guidelines-for-writing-well-behaved-ppxes" class="anchor"></a>Guidelines for writing well-behaved ppxes</h3><p>It's obviously not always (indeed rarely) possible to mint new locations when manipulating the AST.</p><p>The intended way to deal with locations is this:</p><ul><li>AST nodes that exist in the source should keep their original location</li><li>new nodes should be given a &quot;ghost&quot; location (i.e. <code>{ some_loc with loc_ghost = true }</code>) to indicate that the node doesn't exist in the sources.</li></ul><p>Both the new check and merlin will happily traverse these ghost nodes as if they didn't exist. Note: this comes into play when deciding which nodes are &quot;siblings&quot;, for instance if your AST is:</p><pre>      A (B1(C, D),
         B2(X, Y))</pre><p>but <code>B2</code> has a ghost location, then <code>B1</code>, <code>X</code> and <code>Y</code> are considered siblings.</p><p>Additionally, there is an attribute <code>[@merlin.hide]</code> that you can add on nodes to tell merlin (and the check) to ignore this node and all of its children. Some helpers for this are provided in <code>Merlin_helpers</code>.</p></header><div class="spec module" id="module-Non_intersecting_ranges"><a href="#module-Non_intersecting_ranges" class="anchor"></a><code><span class="keyword">module</span> <a href="Non_intersecting_ranges/index.html">Non_intersecting_ranges</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><dl><dt class="spec value" id="val-enforce_invariants"><a href="#val-enforce_invariants" class="anchor"></a><code><span class="keyword">val</span> enforce_invariants : <span>string option</span> <span>&#45;&gt;</span> <span><a href="Non_intersecting_ranges/index.html#type-t">Non_intersecting_ranges.t</a> <a href="../Ppxlib/Ast_traverse/class-fold/index.html">Ppxlib.Ast_traverse.fold</a></span></code></dt></dl></section></div></body></html>